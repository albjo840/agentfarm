# AgentFarm Monetization

> Se Ã¤ven: [INDEX.md](./INDEX.md) | [ARCHITECTURE.md](./ARCHITECTURE.md) | [WEB.md](./WEB.md)

## ğŸŒ Live URL

**Publik portal:** [http://taborsen.duckdns.org:8080/](http://taborsen.duckdns.org:8080/)

## Pricing Model

AgentFarm anvÃ¤nder ett tvÃ¥stegs-system: **Tryout** (gratis) och **Beta Operator** (betald).

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PRICING MODEL                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   TRYOUT (Gratis)           â”‚    â”‚   BETA OPERATOR (29 kr)     â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                             â”‚    â”‚                             â”‚   â”‚
â”‚  â”‚  â€¢ 1 gratis workflow        â”‚    â”‚  â€¢ 10 workflows             â”‚   â”‚
â”‚  â”‚  â€¢ Alla 6 agenter           â”‚    â”‚  â€¢ Alla 6 agenter           â”‚   â”‚
â”‚  â”‚  â€¢ GrundlÃ¤ggande access     â”‚    â”‚  â€¢ Filuppladdning           â”‚   â”‚
â”‚  â”‚                             â”‚    â”‚  â€¢ Custom system prompts    â”‚   â”‚
â”‚  â”‚  Ingen registrering krÃ¤vs   â”‚    â”‚  â€¢ Feedback till utvecklare â”‚   â”‚
â”‚  â”‚  Device-baserad identitet   â”‚    â”‚  â€¢ VPN-access               â”‚   â”‚
â”‚  â”‚                             â”‚    â”‚  â€¢ ZIP-nedladdning          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   AFFILIATE REVENUE         â”‚    â”‚   ADMIN ACCESS              â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                             â”‚    â”‚                             â”‚   â”‚
â”‚  â”‚  â€¢ /hardware sida           â”‚    â”‚  â€¢ Unlimited prompts (âˆ)    â”‚   â”‚
â”‚  â”‚  â€¢ GPU-prestanda stats      â”‚    â”‚  â€¢ Full access to all       â”‚   â”‚
â”‚  â”‚  â€¢ Affiliate-lÃ¤nkar         â”‚    â”‚    features                 â”‚   â”‚
â”‚  â”‚  â€¢ Adtraction integration   â”‚    â”‚  â€¢ Set via scripts/         â”‚   â”‚
â”‚  â”‚                             â”‚    â”‚    set_admin.py             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Access Levels

| Feature | GÃ¤st | Tryout | Beta Operator | Admin |
|---------|------|--------|---------------|-------|
| Visa sidan | âœ… | âœ… | âœ… | âœ… |
| KÃ¶ra workflows | âŒ | 1 st | 10 st | âˆ |
| Filuppladdning | âŒ | âŒ | âœ… | âœ… |
| Custom prompts | âŒ | âŒ | âœ… | âœ… |
| Skicka feedback | âŒ | âŒ | âœ… | âœ… |
| VPN-access | âŒ | âœ… | âœ… | âœ… |
| ZIP-nedladdning | âŒ | âœ… | âœ… | âœ… |

## Subscription Tiers (Kod)

```python
class SubscriptionTier(str, Enum):
    FREE = "free"              # GÃ¤st, ingen access
    TRYOUT = "tryout"          # Har testat (1 gratis workflow)
    BETA_OPERATOR = "beta_operator"  # Betalande (29 kr, 10 workflows)
    EARLY_ACCESS = "early_access"    # Legacy tier
    PRO = "pro"                # Framtida tier
```

## Modulstruktur

```
src/agentfarm/monetization/
â”œâ”€â”€ __init__.py              # Exporterar alla klasser
â”œâ”€â”€ tiers.py                 # TierManager (unified controller)
â”œâ”€â”€ affiliates.py            # AffiliateManager, click tracking
â”œâ”€â”€ stripe_integration.py    # StripeIntegration
â”œâ”€â”€ users.py                 # UserManager, UserProfile
â””â”€â”€ feedback.py              # FeedbackManager
```

## UserManager API

```python
from agentfarm.monetization import UserManager, SubscriptionTier

users = UserManager(storage_dir=".agentfarm")

# HÃ¤mta eller skapa anvÃ¤ndare
user = users.get_or_create_user(device_id)

# Kolla om anvÃ¤ndare Ã¤r Beta Operator
if users.is_beta_operator(device_id):
    # Har access till premium-funktioner
    pass

# Uppgradera till Beta Operator (efter Stripe-betalning)
users.upgrade_to_beta_operator(device_id, stripe_customer_id)
# Ger automatiskt 10 workflows
```

## Stripe Integration

### Environment Variables

```bash
# Obligatoriska
STRIPE_SECRET_KEY=sk_live_...
STRIPE_WEBHOOK_SECRET=whsec_...

# Beta Operator (29 kr, engÃ¥ngsbetalning)
STRIPE_BETA_OPERATOR_PRICE_ID=price_1SrD6WHKMZEfwz9FBZTwDejG

# URLs
STRIPE_SUCCESS_URL=http://taborsen.duckdns.org:8080/?payment=success
STRIPE_CANCEL_URL=http://taborsen.duckdns.org:8080/?payment=cancelled
```

### Checkout Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GÃ¤st     â”‚â”€â”€â”€â–¶â”‚  Tryout Modal   â”‚â”€â”€â”€â–¶â”‚  1 workflow  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tryout    â”‚â”€â”€â”€â–¶â”‚ Beta Operator   â”‚â”€â”€â”€â–¶â”‚ Stripe       â”‚
â”‚  user      â”‚    â”‚ Modal (29 kr)   â”‚    â”‚ Checkout     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                                                â–¼
                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                         â”‚ Webhook:     â”‚
                                         â”‚ upgrade_     â”‚
                                         â”‚ beta_operatorâ”‚
                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API Endpoints

| Endpoint | Metod | Beskrivning |
|----------|-------|-------------|
| `/api/user` | GET | HÃ¤mta anvÃ¤ndarprofil (inkl. is_beta_operator) |
| `/api/user/tryout` | POST | Starta tryout (1 gratis workflow) |
| `/api/checkout/beta-operator` | POST | Skapa Stripe checkout fÃ¶r Beta Operator |
| `/webhook/stripe` | POST | Stripe webhook handler |
| `/api/feedback` | POST | Skicka feedback (Beta Operator only) |
| `/api/user/agent-prompts` | POST | SÃ¤tt custom prompts (Beta Operator only) |
| `/api/files/upload` | POST | Ladda upp filer (Beta Operator only) |

### Webhook Events

| Event | Action | Resultat |
|-------|--------|----------|
| `checkout.session.completed` (beta_operator) | `upgrade_beta_operator` | Tier â†’ BETA_OPERATOR, +10 workflows |
| `customer.subscription.deleted` | `downgrade_tier` | Tier â†’ FREE |

## Affiliate System

### AffiliateManager

```python
from agentfarm.monetization import AffiliateManager

manager = AffiliateManager(storage_dir=".agentfarm")

# HÃ¤mta produkter
products = manager.get_products(category="gpu")

# SpÃ¥ra klick
url, click = manager.track_click(
    product_id="amd_7900xtx",
    retailer_id="dustin",
    device_id=user_device_id,
)
```

### Konfigurerade retailers

| Retailer | Status |
|----------|--------|
| Dustin | Aktiv |
| Komplett | Aktiv |
| Inet | Aktiv |
| Adtraction | Konfigureras |

## Feedback System (Beta Operator only)

```python
from agentfarm.monetization import FeedbackManager

feedback = FeedbackManager(storage_dir=".agentfarm")

# Endast Beta Operators kan skicka feedback
entry = feedback.create_feedback(
    device_id="user123",
    message="Feedback...",
    category="bug",  # bug, feature, ux, performance, general
    rating=4,
)
```

## Storage

```
.agentfarm/
â”œâ”€â”€ users/                   # UserProfile JSON-filer
â”‚   â”œâ”€â”€ device123.json
â”‚   â””â”€â”€ device456.json
â”œâ”€â”€ tokens/
â”‚   â””â”€â”€ transactions.json    # Token/prompt transaktioner
â”œâ”€â”€ feedback/                # Feedback entries
â”‚   â””â”€â”€ fb_abc123.json
â”œâ”€â”€ affiliates.json          # Affiliate config
â””â”€â”€ analytics/
    â””â”€â”€ affiliate_clicks.json
```

## SÃ¤kerhet

| Resurs | Publik | Skydd |
|--------|--------|-------|
| Web UI (port 8080) | âœ… | GÃ¤ster kan se, premium bakom betalning |
| Ollama API (11434) | âŒ | Blockerad av brandvÃ¤gg |
| VPN (51820) | âœ… | KrÃ¤ver WireGuard-config |
| GitLab (443) | âœ… | KrÃ¤ver inloggning |

---

*Se Ã¤ven: [SECURITY.md](./SECURITY.md) | [WEB.md](./WEB.md)*
